{% extends "base.html" %}
{% block page_content %}
<ul class="entries">
    <h2 id="marker"></h2>
    {% for event in event_list %}
    <span id={{ event.id }}><h2>{{ event.title }}</h2></span>
    <script type="text/javascript">
        var dateString = "{{ event.thedate }}";
        dateString = dateString.replace(/-/g, ' ');
        var d = new Date(dateString);
        $('#{{ event.id }}').after('<span id=p'+ {{ event.id }} +'<p>' + "{{ event.room|safe }}<br>" + d.toDateString() + ', ' + d.toLocaleTimeString() + '</p></span>'); 
    </script>
    {% if session.admin %}
    <a href={{ url_for('events.edit_event', id=event.id) }}>edit</a>
    {% endif %}
    {% else %}
        <em id="em">No events here so far</em>
    {% endfor %}
</ul>
<script type="text/javascript">
    setInterval(function() {
        $.getJSON($SCRIPT_ROOT + '/test', {}, function(data) {
            var data_id = parseInt(data.id);
            if (data_id != -1) {
                var to_str = String(data_id);
                var h2_id = document.getElementById(to_str);
                if (h2_id != null) {
                } else {
                    if (! $('#data.id').length) {
                    $('#em').hide();
                    var dateString = data.thedate;
                    dateString = dateString.replace(/-/g, ' ');
                    dateString = dateString.replace(/GMT/g, ' ');
                    var d = new Date(dateString);
                    $('#marker').after('<span id=' + data.id + '><h2>' + data.title + '</h2><span id=p' + data.id + '<p>' + data.room + '<br>' + d.toDateString() + ', ' + d.toLocaleTimeString() + '</p></span>');
                    console.log(data.replaced_id);
                    if (data.replaced_id != -1) {
                        $('span[id*=' + data.replaced_id + ']').remove();
                    }
                    }
                }
            }
            return false;
        });
    }, 15000);
</script>
{% endblock %}
